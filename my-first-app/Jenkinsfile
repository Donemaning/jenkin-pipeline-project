pipeline {
    agent any
    environment {
        EC2_HOST = "YOUR_EC2_INSTANCE_IP"
        APP_DIR = "/home/ubuntu/todo-app"
        SSH_CREDENTIALS_ID = "ec2-ssh-key"
    }
    stages {
        stage('Clone Repository') {
            steps {
                // Pull code from the GitHub repository
                checkout scm
            }
        }
        stage('Build Application') {
            steps {
                echo "Building the application..."
                // Add build commands specific to your app (e.g., npm install)
                sh "echo 'No build needed for this example'"
            }
        }
        stage('Deploy to EC2') {
            steps {
                echo "Deploying application to EC2 instance..."
                sshagent([SSH_CREDENTIALS_ID]) {
                    sh """
                    ssh -o StrictHostKeyChecking=no ubuntu@${EC2_HOST} "mkdir -p ${APP_DIR}"
                    scp -o StrictHostKeyChecking=no -r * ubuntu@${EC2_HOST}:${APP_DIR}
                    ssh ubuntu@${EC2_HOST} "cd ${APP_DIR} && ./start.sh"
                    """
                }
            }
        }
        stage('Verify Deployment') {
            steps {
                echo "Verifying deployment..."
                sshagent([SSH_CREDENTIALS_ID]) {
                    sh """
                    ssh ubuntu@${EC2_HOST} "curl -s http://localhost:8080 || echo 'Application not running'"
                    """
                }
            }
        }
    }
}
